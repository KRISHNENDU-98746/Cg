<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>T-Shirt Store</title>
  <style>
    body {
      font-family: Poppins, sans-serif;
      margin: 0; padding: 0;
      background: #f9f9f9;
      text-align: center;
    }
    header {
      background: #222; color: white;
      padding: 15px; font-size: 20px;
    }
    .btn {
      background: #4CAF50; color: white;
      border: none; padding: 10px 20px;
      border-radius: 6px; cursor: pointer;
    }
    .product {
      background: white; width: 250px;
      margin: 20px auto; padding: 15px;
      border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    img { width: 100%; border-radius: 8px; }
    .cart { background: #fff; margin: 20px; padding: 20px; border-radius: 10px; }
    input, textarea {
      width: 90%; padding: 10px; margin: 8px 0;
      border: 1px solid #ccc; border-radius: 6px;
    }
  </style>
</head>
<body>
  <header>üëï T-Shirt Store</header>

  <div id="userSection">
    <button id="googleLogin" class="btn">Login with Google</button>
    <p id="userInfo"></p>
  </div>

  <div id="store" style="display:none;">
    <div class="product">
      <img src="https://i.imgur.com/YZKQZQF.png" alt="T-shirt">
      <h3>Classic White T-Shirt</h3>
      <p>Price: $20</p>
      <button class="btn" id="addToCartBtn">Add to Cart</button>
    </div>

    <div id="cart" class="cart" style="display:none;">
      <h3>üõç Your Cart</h3>
      <div id="cartItems"></div>
      <h4>Total: $<span id="total">0</span></h4>
      <textarea id="address" placeholder="Enter your shipping address..."></textarea><br>
      <button class="btn" id="checkoutBtn">Checkout</button>
    </div>
  </div>

  <script type="module">
    // === Import Firebase SDKs ===
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    // === Firebase Configuration ===
    const firebaseConfig = {
      apiKey: "AIzaSyD7CGdjI-VaNl2AnB54dPAVBh9mAIF9j7o",
      authDomain: "thelong-6274a.firebaseapp.com",
      projectId: "thelong-6274a",
      storageBucket: "thelong-6274a.firebasestorage.app",
      messagingSenderId: "729094241594",
      appId: "1:729094241594:web:17b32ea302bb45814fa403",
      measurementId: "G-DPSPS3MDBF"
    };

    // === Initialize Firebase ===
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // === UI Elements ===
    const googleLogin = document.getElementById('googleLogin');
    const userInfo = document.getElementById('userInfo');
    const store = document.getElementById('store');
    const cartDiv = document.getElementById('cart');
    const addToCartBtn = document.getElementById('addToCartBtn');
    const cartItems = document.getElementById('cartItems');
    const totalSpan = document.getElementById('total');
    const checkoutBtn = document.getElementById('checkoutBtn');
    const addressBox = document.getElementById('address');

    let currentUser = null;
    let cart = [];

    // === Google Login ===
    googleLogin.onclick = async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        currentUser = result.user;
        userInfo.innerHTML = `Welcome, ${currentUser.displayName} <br> <button class="btn" id="logoutBtn">Logout</button>`;
        googleLogin.style.display = 'none';
        store.style.display = 'block';

        document.getElementById('logoutBtn').onclick = async () => {
          await signOut(auth);
          location.reload();
        };
      } catch (error) {
        alert(error.message);
      }
    };

    // === Add to Cart ===
    addToCartBtn.onclick = () => {
      cart.push({ name: "Classic White T-Shirt", price: 20 });
      updateCart();
    };

    function updateCart() {
      cartDiv.style.display = 'block';
      cartItems.innerHTML = "";
      let total = 0;
      cart.forEach((item) => {
        cartItems.innerHTML += `<p>${item.name} - $${item.price}</p>`;
        total += item.price;
      });
      totalSpan.textContent = total;
    }

    // === Checkout & Save Order ===
    checkoutBtn.onclick = async () => {
      const address = addressBox.value.trim();
      if (!address) return alert("Please enter your address!");
      if (!currentUser) return alert("Please login first!");

      try {
        await setDoc(doc(db, "orders", currentUser.uid), {
          name: currentUser.displayName,
          email: currentUser.email,
          cart: cart,
          address: address,
          time: new Date().toISOString()
        });
        alert("‚úÖ Order placed successfully!");
        cart = [];
        updateCart();
        addressBox.value = "";
      } catch (err) {
        alert("Error: " + err.message);
      }
    };
  </script>
</body>
</html>
