<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TheLong eCommerce (Firebase)</title>
  <style>
    body { font-family: Poppins, sans-serif; background: #f5f7fa; margin: 0; }
    header { background: #007bff; color: white; text-align: center; padding: 15px; font-size: 22px; }
    .container { width: 90%; max-width: 600px; margin: 20px auto; background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    input, button, textarea { width: 100%; padding: 10px; margin-top: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 15px; }
    button { background: #007bff; color: white; font-weight: bold; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    .product { text-align: center; margin-top: 15px; }
    .product img { width: 100%; border-radius: 10px; }
    .cart ul { list-style: none; padding: 0; }
    .cart li { background: #eef3ff; margin: 5px 0; padding: 8px; border-radius: 6px; }
    .success { background: #d4edda; color: #155724; text-align: center; padding: 10px; margin-top: 15px; border-radius: 8px; }
  </style>
</head>
<body>
  <header>üõçÔ∏è TheLong eCommerce Store</header>

  <div id="authDiv" class="container">
    <h3>Login or Sign Up</h3>
    <input id="email" type="email" placeholder="Email" required />
    <input id="password" type="password" placeholder="Password" required />
    <button onclick="signup()">Sign Up</button>
    <button onclick="login()">Login</button>
  </div>

  <div id="shopDiv" class="container" style="display:none;">
    <h2>Welcome, <span id="userEmail"></span></h2>
    <button onclick="logout()">Logout</button>
    <div class="product">
      <img src="https://i.imgur.com/UYiroys.jpg" alt="T-shirt" />
      <h3>Classic Cotton T-Shirt</h3>
      <p>‚Çπ499</p>
      <button onclick="addToCart('Classic Cotton T-Shirt', 499)">Add to Cart</button>
    </div>

    <div class="cart">
      <h3>Your Cart</h3>
      <ul id="cartList"></ul>
      <h3 id="totalPrice">Total: ‚Çπ0</h3>
    </div>

    <div class="checkout">
      <h3>Checkout</h3>
      <textarea id="address" placeholder="Enter your delivery address..."></textarea>
      <button onclick="checkout()">Place Order</button>
      <div id="msg"></div>
    </div>
  </div>

  <script type="module">
    // ================= Firebase Setup =================
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD7CGdjI-VaNl2AnB54dPAVBh9mAIF9j7o",
      authDomain: "thelong-6274a.firebaseapp.com",
      databaseURL: "https://thelong-6274a-default-rtdb.firebaseio.com",
      projectId: "thelong-6274a",
      storageBucket: "thelong-6274a.firebasestorage.app",
      messagingSenderId: "729094241594",
      appId: "1:729094241594:web:17b32ea302bb45814fa403",
      measurementId: "G-DPSPS3MDBF"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ================= Auth Logic =================
    const authDiv = document.getElementById("authDiv");
    const shopDiv = document.getElementById("shopDiv");
    const userEmail = document.getElementById("userEmail");

    async function signup() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      try {
        await createUserWithEmailAndPassword(auth, email, password);
        alert("Signup successful! Please log in.");
      } catch (err) {
        alert(err.message);
      }
    }

    async function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        alert("Login successful!");
      } catch (err) {
        alert(err.message);
      }
    }

    async function logout() {
      await signOut(auth);
      alert("Logged out!");
    }

    onAuthStateChanged(auth, (user) => {
      if (user) {
        authDiv.style.display = "none";
        shopDiv.style.display = "block";
        userEmail.textContent = user.email;
      } else {
        authDiv.style.display = "block";
        shopDiv.style.display = "none";
      }
    });

    // ================= Cart & Checkout =================
    let cart = [];

    window.addToCart = function (name, price) {
      cart.push({ name, price });
      renderCart();
      alert("Added to cart!");
    };

    function renderCart() {
      const cartList = document.getElementById("cartList");
      const totalPrice = document.getElementById("totalPrice");
      cartList.innerHTML = "";
      let total = 0;
      cart.forEach((item) => {
        total += item.price;
        const li = document.createElement("li");
        li.textContent = `${item.name} - ‚Çπ${item.price}`;
        cartList.appendChild(li);
      });
      totalPrice.textContent = "Total: ‚Çπ" + total;
    }

    window.checkout = async function () {
      const address = document.getElementById("address").value.trim();
      if (cart.length === 0) return alert("Cart is empty!");
      if (!address) return alert("Please enter your address!");

      const user = auth.currentUser;
      if (!user) return alert("You must be logged in!");

      try {
        await addDoc(collection(db, "orders"), {
          user: user.email,
          address: address,
          cart: cart,
          total: cart.reduce((sum, i) => sum + i.price, 0),
          date: new Date().toLocaleString()
        });
        document.getElementById("msg").innerHTML =
          '<div class="success">‚úÖ Order placed successfully!</div>';
        cart = [];
        renderCart();
        document.getElementById("address").value = "";
      } catch (err) {
        alert("Error saving order: " + err.message);
      }
    };
  </script>
</body>
</html>
